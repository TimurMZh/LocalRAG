# Система хранения файлов (MinIO)

## Обзор

MinIO интегрирован в Репозиторий как надежное и масштабируемое решение для хранения файлов. Это S3-совместимое объектное хранилище обеспечивает эффективное управление файлами в распределенной системе.

## Установка и настройка

MinIO в нашей архитектуре выполняет следующие функции:
- Хранение больших файлов и датасетов
- Управление бинарными данными
- Обеспечение доступа к общим ресурсам между сервисами

### Быстрый старт с Docker

Для запуска MinIO с помощью Docker используйте следующую команду:

```bash
docker run -p 9000:9000 -p 9001:9001 \
  -e "MINIO_ROOT_USER=minioadmin" \
  -e "MINIO_ROOT_PASSWORD=minioadmin" \
  minio/minio server /data --console-address ":9001"
```
После запуска контейнера:
- API endpoint доступен по адресу: `http://localhost:9000`
- Веб-консоль доступна по адресу: `http://localhost:9001`

### Интеграция с системой

Для запуска приложения через API, необходимо инициализировать MinIO клиент.

```python
from minio import Minio

minio_client = Minio(
    f"{os.getenv('MINIO_HOST')}:{os.getenv('MINIO_PORT')}",
    access_key=os.getenv('MINIO_ROOT_USER'),
    secret_key=os.getenv('MINIO_ROOT_PASSWORD'),
    secure=False  # True для production
)
```

### Конфигурация

Базовая конфигурация MinIO определяется в переменных окружения:

```bash
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_HOST=localhost
MINIO_PORT=9000
```

## Основные операции

### Загрузка файлов

```python
def upload_file(bucket_name: str, object_name: str, file_path: str):
    """
    Загрузка файла в MinIO
    """
    try:
        with open(file_path, "rb") as file_data:
            file_stat = os.stat(file_path)
            minio_client.put_object(
                bucket_name,
                object_name,
                file_data,
                file_stat.st_size
            )
    except Exception as e:
        logger.error(f"Ошибка при загрузке файла: {e}")
        raise
```

### Получение файлов

```python
def download_file(bucket_name: str, object_name: str, file_path: str):
    """
    Скачивание файла из MinIO
    """
    try:
        minio_client.fget_object(
            bucket_name,
            object_name,
            file_path
        )
    except Exception as e:
        logger.error(f"Ошибка при скачивании файла: {e}")
        raise
```

## Безопасность

При работе с MinIO следует учитывать следующие аспекты безопасности:

1. **Аутентификация**:
   - Используйте сильные пароли в production
   - Храните учетные данные в защищенных переменных окружения
   - Применяйте политики IAM для контроля доступа

2. **Шифрование**:
   - Включите TLS для production окружения
   - Используйте шифрование на стороне сервера для чувствительных данных
   - Настройте шифрование в состоянии покоя

3. **Сетевая безопасность**:
   - Ограничьте доступ к MinIO через файерволы
   - Используйте приватные сети в облачных развертываниях
   - Настройте CORS политики правильно

## Мониторинг и обслуживание

- Настройте мониторинг использования хранилища
- Регулярно проверяйте целостность данных
- Реализуйте политики резервного копирования
- Следите за метриками производительности

## Рекомендации по использованию

1. **Организация бакетов**:
   - Создавайте отдельные бакеты для разных типов данных
   - Используйте понятную систему именования
   - Применяйте теги для лучшей организации

2. **Оптимизация производительности**:
   - Используйте многопоточную загрузку для больших файлов
   - Реализуйте кэширование часто используемых файлов
   - Следите за размером объектов

3. **Управление жизненным циклом**:
   - Настройте политики удаления устаревших данных
   - Реализуйте версионирование важных файлов
   - Регулярно проводите аудит использования

## Устранение неполадок

При возникновении проблем проверьте:

1. Доступность MinIO сервера
2. Правильность учетных данных
3. Наличие необходимых прав доступа
4. Сетевые подключения
5. Достаточность места в хранилище 