## Быстрый старт

Это руководство предоставляет минимальные шаги, необходимые для быстрого запуска Репозитория. Оно идеально подходит для разработчиков, которые хотят протестировать платформу или начать работу с минимальной настройкой. Для получения более подробной информации о процессе установки, рекомендаций по безопасности и устранению неполадок, обратитесь к Руководству по установке.

### Предварительные требования

- Python 3.12 или выше
- Docker и Docker Compose  
- Git
- Редактор кода (рекомендуется VS Code или Cursor)

### Быстрый старт

#### 1. Клонирование репозитория

```bash
git clone https://github.com/noteldar/llm-pipeline
cd llm-pipeline
```

#### 2. Создание и настройка файлов окружения

```bash
cp app/.env.example app/.env
cp docker/.env.example docker/.env
```

Вы можете оставить файл `docker/.env` как есть для быстрого старта. Однако вам нужно добавить ваш ключ API OpenAI в файл `app/.env`. Откройте `app/.env` и найдите переменную `OPENAI_API_KEY`. Замените ее значение на ваш фактический ключ API OpenAI:

```yaml
OPENAI_API_KEY=your_openai_api_key_here
```

#### 3. Создание и запуск контейнеров Docker

```bash
cd ./docker
./start.sh
```

#### 3.1. Убедитесь, что модель Roberta-Kaz-Large загружена

Если вы используете модель Roberta-Kaz-Large, убедитесь, что она загружена в папку `models/roberta-kaz-large`. Если модель отсутствует, скачайте её вручную или настройте автоматическую загрузку в коде. Например:

```bash
python app/models/download_model.py
```

Этот скрипт автоматически загрузит модель в нужное место.

#### 3.2. Запуск Milvus Standalone Docker

Milvus используется для хранения векторных эмбеддингов. Убедитесь, что Milvus запущен перед загрузкой документов или выполнением запросов. Для этого выполните следующую команду:

```bash
cd docker
./start.sh milvus-standalone-docker-compose.yml
```

Эта команда запустит Milvus в режиме standalone.


#### 4. Создание миграций базы данных

```bash
cd ../app
./makemigration.sh  # Create a new migration
./migrate.sh        # Apply migrations
```

При появлении запроса на сообщение миграции, вы можете ввести краткое описание, например "Initial migration" или "Launch".

#### 5. Start logging:

```bash
cd ../docker
./logs.sh
```

#### 6. Создание виртуального окружения и установка зависимостей

```bash
# Create a new virtual environment
python -m venv venv

# Activate the virtual environment
# On Windows:
venv\Scripts\activate
# On macOS and Linux:
source venv/bin/activate

# Install the required packages
cd app
pip install -r requirements.txt
```

#### 7. Заполнение векторного хранилища

Чтобы инициализировать векторное хранилище с образцом данных, запустите:

```bash
python app/utils/insert_vectors.py
```

#### 7.1. Инициализация базы данных Milvus

После установки и запуска Milvus Standalone, необходимо инициализировать базу данных. Для этого выполните следующий скрипт:

```bash
python app/utils/init_mivus_collection.py
```

Этот скрипт создаст необходимые коллекции и индексы в Milvus.

#### 8. Отправка события

Запустите следующую команду, чтобы отправить тестовое событие, используя файл invoice.json и библиотеку requests:

```bash
python requests/send_event.py
```

Вы должны получить `202` статусный код и увидеть ответ в терминале, где вы запускаете `./logs.sh`. Здесь вы должны увидеть, что сервис invoice должен быть вызван и что задача успешно завершена.

Этот шаг создает необходимые таблицы, индексы и добавляет начальные векторные данные в базу данных.

#### 9. Проверка базы данных

Подключитесь к базе данных, используя ваш любимый инструмент для работы с базами данных. Настройки по умолчанию:

- Host: localhost
- Port: 5432
- Database: launchpad
- Username: postgres
- Password: super-secret-postgres-password

В таблице `events` вы должны увидеть обработанное событие. Оно содержит исходные данные (JSON) в колонке `data` и обработанное событие (JSON) в колонке `task_context`.

#### 9. Запуск фронтенда

Фронтенд предоставляет пользовательский интерфейс для взаимодействия с системой. Чтобы запустить фронтенд, выполните следующие шаги:

1. Перейдите в директорию `frontend`:

```bash
cd frontend
```

2. Установите зависимости:

```bash
npm install
```

3. Запустите фронтенд в режиме разработки:

```bash
npm run dev
```

4. Откройте браузер и перейдите по адресу, указанному в консоли (обычно http://localhost:5173).

#### Основные страницы веб-интерфейса

После запуска фронтенда доступны следующие страницы:

- **Загрузка документов:** [http://localhost:5173/upload](http://localhost:5173/upload)
  - Страница для загрузки документов (TXT, DOCX, PDF, JSON, XML) в систему.

- **Поиск по документам:** [http://localhost:5173/search](http://localhost:5173/search)
  - Интерфейс для семантического поиска по загруженным документам.

- **Чат с ИИ:** [http://localhost:5173/chat](http://localhost:5173/chat)
  - Страница для общения с языковой моделью на основе загруженных данных.

#### 10. Эксперименты в playground

Директория playground содержит несколько Python скриптов, которые помогут вам поэкспериментировать с различными компонентами Репозитория:

- Используйте `playground/llm_playground.py` для экспериментов с LLM factory и структурированным выводом.
- Используйте `playground/pipeline_playground.py` для запуска pipeline с различными примерами событий.
- Используйте `playground/prompt_playground.py` для тестирования и улучшения шаблонов промптов.

Рекомендуется запускать их с помощью **Python interactive window**, о котором вы можете узнать больше [здесь](https://youtu.be/mpk4Q5feWaw?t=1346).

Если вы используете VS Code или Cursor, я также рекомендую добавить следующие настройки в ваш файл `.code-workspace` для упрощения работы с импортами и рефакторингом:

```json
"settings": {
  "jupyter.notebookFileRoot": "${workspaceFolder}/app",
  "python.analysis.extraPaths": ["./app"],
  "python.testing.pytestArgs": [
   "app"
  ],
}
```

Для экспериментов с LLM factory и структурированным выводом:

```bash
python playground/llm_playground.py
```

Для запуска pipeline с образцом события:

```bash
python playground/pipeline_playground.py
```

Для тестирования шаблонов промптов:

```bash
python playground/prompt_playground.py
```

Не стесняйтесь модифицировать эти скрипты и использовать примеры событий в директории `requests/events/`, чтобы лучше понять, как работают различные компоненты.


## Конфигурация

Конфигурация управляется через переменные окружения и файлы настроек. Ключевые конфигурационные файлы:

- `app/.env`: Настройки приложения
- `docker/.env`: Конфигурации Docker и сервисов 
- `app/config/settings.py`: Настройки приложения и LLM моделей

Обратитесь к файлам `.env.example` для просмотра доступных опций.

## Процесс разработки

Вот план действий высокого уровня для адаптации шаблона под ваш уникальный проект:

1. Обновите файлы '.env' вашими API ключами и паролями
2. Обновите настройки в `app/config`
3. Определите события в `requests/events` (ваши входящие данные)
4. Обновите схему API в `app/api/event_schema.py` (в соответствии с вашими событиями)
5. Определите ваши AI pipeline'ы и шаги обработки в `app/pipelines/`
6. Добавьте ваши векторные эмбеддинги в базу данных используя `app/utils/insert_vectors.py` (опционально, для RAG)
7. Экспериментируйте с различными AI моделями, данными и настройками в 'playground'
8. Настройте ваши pipeline'ы и поток приложения

## Развертывание

Проект включает полную стратегию развертывания на основе Docker. Для развертывания:

1. Убедитесь, что ваши production конфигурации установлены в файлах `.env`.
2. Соберите и запустите Docker контейнеры:

```bash
cd docker
./start.sh
```

Caddy предварительно настроен для обработки HTTPS, упрощая процесс развертывания.

## Устранение неполадок

### Ошибки при первоначальном развертывании

Если вы столкнетесь с ошибками при первоначальном развертывании, особенно связанными с базой данных или отсутствием таблиц, рекомендуется удалить все контейнеры и тома, чтобы начать с чистого листа. Это гарантирует, что вы работаете в новом окружении без конфликтов данных из предыдущих попыток.

Следуйте этим шагам, чтобы очистить ваше окружение Docker:

1. Остановите все запущенные контейнеры:

```bash
docker compose down
```

2. Удалите все контейнеры, связанные с проектом:

```bash
docker rm $(docker ps -a -q --filter name=launchpad_*)
```

3. Удалите все тома, связанные с проектом:

```bash
docker volume rm $(docker volume ls -q --filter name=launchpad_*)
```

4. Опционально, вы можете удалить все неиспользуемые тома (будьте осторожны, если у вас есть другие проекты, использующие Docker):

```bash
docker volume prune
```

5. Пересоберите и запустите контейнеры:

```bash
cd docker
./start.sh
```

6. Перезапустите скрипты миграции:
 
```bash
cd ../app
./makemigration.sh
./migrate.sh
```

После выполнения этих шагов, вы должны иметь чистое окружение для работы. Если вы продолжаете испытывать проблемы, пожалуйста, проверьте логи для более подробных сообщений об ошибках:

```bash
cd docker
./logs.sh
```

Если проблемы не исчезают, убедитесь, что все переменные окружения установлены правильно в ваших файлах `.env` и что нет конфликтов с другими службами, работающими на вашей машине.
